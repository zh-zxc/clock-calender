<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ—¶é’Ÿåº”ç”¨ - é«˜çº§ç‰ˆ">
    <title>Chronos - é«˜çº§æ—¶é’Ÿåº”ç”¨</title>
    <style>
        /* ==================== å…¨å±€å˜é‡ ==================== */
        :root {
            /* æ·±è‰²ä¸»é¢˜ - é«˜çº§é»‘ */
            --bg-dark: #0a0a0f;
            --bg-dark-2: #12121a;
            --bg-dark-3: #1a1a25;
            
            /* æµ…è‰²ä¸»é¢˜ - é«˜çº§ç° */
            --bg-light: #f8f9fa;
            --bg-light-2: #e9ecef;
            --bg-light-3: #dee2e6;
            
            /* æ–‡å­—é¢œè‰² */
            --text-dark: #ffffff;
            --text-dark-secondary: #a0a0b0;
            --text-light: #1a1a1a;
            --text-light-secondary: #6c757d;
            
            /* ä¸»è‰²è°ƒ - é«˜çº§è“ */
            --primary: #4a9eff;
            --primary-hover: #3a8eef;
            --primary-glow: rgba(74, 158, 255, 0.3);
            
            /* å¼ºè°ƒè‰² - é«˜çº§ç´« */
            --accent: #8b5cf6;
            --accent-hover: #7c3aed;
            --accent-glow: rgba(139, 92, 246, 0.3);
            
            /* æˆåŠŸè‰² - é«˜çº§ç»¿ */
            --success: #10b981;
            --success-glow: rgba(16, 185, 129, 0.3);
            
            /* è­¦å‘Šè‰² - é«˜çº§é»„ */
            --warning: #f59e0b;
            --warning-glow: rgba(245, 158, 11, 0.3);
            
            /* å±é™©è‰² - é«˜çº§çº¢ */
            --danger: #ef4444;
            --danger-glow: rgba(239, 68, 68, 0.3);
            
            /* è¾¹æ¡† */
            --border: rgba(255, 255, 255, 0.08);
            --border-light: rgba(0, 0, 0, 0.05);
            
            /* é˜´å½± */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 20px rgba(74, 158, 255, 0.2);
            
            /* åœ†è§’ */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 20px;
            
            /* é—´è· */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 24px;
            --space-2xl: 32px;
            --space-3xl: 48px;
            
            /* åŠ¨ç”» */
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ==================== åŸºç¡€é‡ç½® ==================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* ==================== ä¸»å®¹å™¨ ==================== */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-dark);
            min-height: 100vh;
            padding: var(--space-xl);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
            transition: background 0.3s var(--ease-smooth);
        }

        body.light {
            background: var(--bg-light);
            color: var(--text-light);
        }

        /* é«˜çº§èƒŒæ™¯ - å¾®å¦™çš„ç½‘æ ¼ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -1;
            pointer-events: none;
        }

        body.light::before {
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.02) 1px, transparent 1px);
        }

        /* ==================== å®¹å™¨å¸ƒå±€ ==================== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ==================== å¤´éƒ¨å¯¼èˆª ==================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2xl);
            padding: var(--space-lg) var(--space-xl);
            background: var(--bg-dark-2);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            transition: all 0.3s var(--ease-smooth);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary));
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }

        body.light .header {
            background: var(--bg-light-2);
            border-color: var(--border-light);
        }

        .header:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-1px);
        }

        .header-title {
            font-weight: 700;
            font-size: 1.4rem;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .header-title span:first-child {
            font-size: 1.6rem;
        }

        .header-actions {
            display: flex;
            gap: var(--space-md);
        }

        /* ==================== æŒ‰é’®ç³»ç»Ÿ ==================== */
        .btn {
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.3px;
            transition: all 0.2s var(--ease-smooth);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            background: var(--bg-dark-3);
            color: var(--text-dark);
            border: 1px solid var(--border);
        }

        body.light .btn {
            background: var(--bg-light-3);
            color: var(--text-light);
            border-color: var(--border-light);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s var(--ease-out);
        }

        .btn:hover::before {
            transform: translateX(100%);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            border: none;
        }

        .btn-primary:hover {
            box-shadow: 0 4px 16px var(--primary-glow);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            color: white;
            border: none;
        }

        .btn-accent:hover {
            box-shadow: 0 4px 16px var(--accent-glow);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            border: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
            border: none;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ==================== æ—¶é’ŸåŒºåŸŸ ==================== */
        .clock-section {
            text-align: center;
            padding: var(--space-3xl) var(--space-2xl);
            background: var(--bg-dark-2);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-2xl);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            transition: all 0.3s var(--ease-smooth);
        }

        body.light .clock-section {
            background: var(--bg-light-2);
            border-color: var(--border-light);
        }

        .clock-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, var(--primary-glow) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s var(--ease-smooth);
            pointer-events: none;
        }

        .clock-section:hover::before {
            opacity: 0.3;
        }

        .clock {
            font-size: 5rem;
            font-weight: 300;
            font-family: 'SF Mono', 'Fira Code', 'Courier New', monospace;
            letter-spacing: 4px;
            margin-bottom: var(--space-lg);
            background: linear-gradient(135deg, var(--text-dark) 0%, var(--primary) 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 200%;
            animation: gradientMove 8s ease-in-out infinite;
            position: relative;
            display: inline-block;
        }

        body.light .clock {
            background: linear-gradient(135deg, var(--text-light) 0%, var(--primary) 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .date-display {
            font-size: 1.2rem;
            font-weight: 400;
            color: var(--text-dark-secondary);
            letter-spacing: 1px;
            opacity: 0.9;
        }

        body.light .date-display {
            color: var(--text-light-secondary);
        }

        /* ==================== ä¸»ç½‘æ ¼å¸ƒå±€ ==================== */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--space-xl);
            margin-bottom: var(--space-2xl);
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ==================== å¡ç‰‡é€šç”¨æ ·å¼ ==================== */
        .card {
            background: var(--bg-dark-2);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            transition: all 0.3s var(--ease-smooth);
            position: relative;
            overflow: hidden;
        }

        body.light .card {
            background: var(--bg-light-2);
            border-color: var(--border-light);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        /* ==================== æ—¥å†æ ·å¼ ==================== */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .calendar-title {
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: var(--primary);
        }

        .calendar-nav {
            display: flex;
            gap: var(--space-sm);
        }

        .calendar-nav button {
            padding: var(--space-xs) var(--space-md);
            background: var(--bg-dark-3);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-dark);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s var(--ease-smooth);
        }

        body.light .calendar-nav button {
            background: var(--bg-light-3);
            color: var(--text-light);
            border-color: var(--border-light);
        }

        .calendar-nav button:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-xs);
        }

        .day-header {
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            padding: var(--space-sm) 0;
            color: var(--text-dark-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.7;
        }

        body.light .day-header {
            color: var(--text-light-secondary);
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            background: var(--bg-dark-3);
            transition: all 0.2s var(--ease-smooth);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
        }

        body.light .day {
            background: var(--bg-light-3);
        }

        .day::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.2s var(--ease-smooth);
            z-index: 0;
        }

        .day > * {
            position: relative;
            z-index: 1;
        }

        .day:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .day:hover::before {
            opacity: 0.1;
        }

        .day.today {
            background: var(--primary);
            color: white;
            font-weight: 600;
            box-shadow: 0 0 10px var(--primary-glow);
        }

        .day.selected {
            background: var(--accent);
            color: white;
            font-weight: 600;
            box-shadow: 0 0 10px var(--accent-glow);
        }

        .day.has-data::after {
            content: '';
            position: absolute;
            bottom: 3px;
            right: 3px;
            width: 4px;
            height: 4px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0.8;
        }

        .day.other-month {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* ==================== æ•°æ®åŒºåŸŸæ ·å¼ ==================== */
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--space-lg);
            color: var(--text-dark);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        body.light .section-title {
            color: var(--text-light);
        }

        .input-group {
            margin-bottom: var(--space-lg);
        }

        .input-group label {
            display: block;
            margin-bottom: var(--space-xs);
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            color: var(--text-dark-secondary);
            opacity: 0.9;
        }

        body.light .input-group label {
            color: var(--text-light-secondary);
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: var(--space-md);
            background: var(--bg-dark-3);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-dark);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.2s var(--ease-smooth);
        }

        body.light .input-group input,
        body.light .input-group textarea {
            background: var(--bg-light-3);
            color: var(--text-light);
            border-color: var(--border-light);
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-glow);
            transform: translateY(-1px);
        }

        .expense-inputs {
            display: flex;
            gap: var(--space-md);
        }

        .expense-inputs input:first-child {
            flex: 0 0 30%;
        }

        .expense-inputs input:last-child {
            flex: 1;
        }

        .items-list {
            margin-top: var(--space-lg);
            max-height: 250px;
            overflow-y: auto;
            border-top: 1px solid var(--border);
            padding-top: var(--space-lg);
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }

        .items-list::-webkit-scrollbar {
            width: 4px;
        }

        .items-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 2px;
        }

        .item {
            background: var(--bg-dark-3);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            border: 1px solid var(--border);
            transition: all 0.2s var(--ease-smooth);
            position: relative;
            overflow: hidden;
        }

        body.light .item {
            background: var(--bg-light-3);
            border-color: var(--border-light);
        }

        .item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.2s var(--ease-smooth);
        }

        .item:hover {
            transform: translateX(4px);
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .item:hover::before {
            opacity: 1;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
        }

        .item-date {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            letter-spacing: 0.3px;
            opacity: 0.9;
        }

        .item-delete {
            background: transparent;
            border: none;
            color: var(--danger);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.2s var(--ease-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .item-delete::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--danger);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s var(--ease-smooth);
            z-index: -1;
        }

        .item-delete:hover {
            color: white;
            transform: scale(1.1);
        }

        .item-delete:hover::before {
            opacity: 1;
        }

        .item-content {
            font-size: 0.95rem;
            line-height: 1.6;
            font-weight: 400;
            word-wrap: break-word;
            color: var(--text-dark-secondary);
        }

        body.light .item-content {
            color: var(--text-light-secondary);
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expense-amount {
            font-weight: 700;
            color: var(--accent);
            font-size: 1.2rem;
            font-family: 'SF Mono', 'Fira Code', monospace;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-lg);
            padding: var(--space-lg);
            background: var(--bg-dark-3);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }

        body.light .stats-bar {
            background: var(--bg-light-3);
            border-color: var(--border-light);
        }

        .stat-item {
            text-align: center;
            padding: var(--space-md);
            background: var(--bg-dark-2);
            border-radius: var(--radius-sm);
            transition: all 0.2s var(--ease-smooth);
            border: 1px solid var(--border);
        }

        body.light .stat-item {
            background: var(--bg-light-2);
            border-color: var(--border-light);
        }

        .stat-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-bottom: var(--space-xs);
            font-weight: 600;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'SF Mono', 'Fira Code', monospace;
        }

        body.light .stat-value {
            color: var(--primary);
        }

        /* ==================== ç©ºçŠ¶æ€ ==================== */
        .empty-state {
            text-align: center;
            padding: var(--space-2xl) var(--space-xl);
            color: var(--text-dark-secondary);
            background: var(--bg-dark-3);
            border-radius: var(--radius-md);
            border: 1px dashed var(--border);
            opacity: 0.7;
        }

        body.light .empty-state {
            background: var(--bg-light-3);
            color: var(--text-light-secondary);
            border-color: var(--border-light);
        }

        .empty-state-icon {
            font-size: 2.5rem;
            margin-bottom: var(--space-md);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 0.95rem;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        /* ==================== æ¸¸æˆåŒºåŸŸ ==================== */
        .game-section {
            margin-bottom: var(--space-2xl);
        }

        .game-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-lg);
            flex-wrap: wrap;
        }

        .game-stats {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .game-stats .stat-item {
            min-width: 80px;
            padding: var(--space-md);
        }

        .game-controls {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .game-controls .btn {
            padding: var(--space-sm) var(--space-md);
            font-size: 0.85rem;
        }

        /* æ¸¸æˆåˆ‡æ¢æŒ‰é’® */
        .game-tabs {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
        }

        .game-tabs .btn {
            flex: 1;
            min-width: 120px;
            padding: var(--space-md);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .game-tabs .btn.btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            border: none;
            box-shadow: 0 4px 12px var(--primary-glow);
        }

        .game-tabs .btn.btn-secondary {
            background: var(--bg-dark-3);
            border: 1px solid var(--border);
        }

        body.light .game-tabs .btn.btn-secondary {
            background: var(--bg-light-3);
            border-color: var(--border-light);
        }

        .game-tabs .btn.active {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--primary-glow);
            border: 2px solid var(--primary);
        }

        /* æ¸¸æˆæ¶ˆæ¯ */
        .game-message {
            text-align: center;
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 1rem;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s var(--ease-smooth);
            border: 1px solid var(--border);
            background: var(--bg-dark-3);
        }

        body.light .game-message {
            background: var(--bg-light-3);
            border-color: var(--border-light);
        }

        .game-message.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border-color: var(--success);
            color: var(--success);
        }

        .game-message.info {
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.1), rgba(58, 142, 239, 0.1));
            border-color: var(--primary);
            color: var(--primary);
        }

        .game-message.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            border-color: var(--warning);
            color: var(--warning);
        }

        /* ==================== æ¸¸æˆæ¿é€šç”¨æ ·å¼ ==================== */
        .game-board {
            display: grid;
            gap: 2px;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
            background: var(--bg-dark-3);
            border-radius: var(--radius-md);
            padding: var(--space-sm);
            border: 1px solid var(--border);
        }

        body.light .game-board {
            background: var(--bg-light-3);
            border-color: var(--border-light);
        }

        /* ==================== è®°å¿†ç¿»ç‰Œæ¸¸æˆ ==================== */
        .memory-board {
            grid-template-columns: repeat(4, 1fr);
        }

        .game-card {
            aspect-ratio: 1;
            background: var(--bg-dark-2);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: transparent;
            transition: all 0.2s var(--ease-smooth);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        body.light .game-card {
            background: var(--bg-light-2);
            border-color: var(--border-light);
        }

        .game-card:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 4px 12px var(--primary-glow);
        }

        .game-card.flipped {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .game-card.matched {
            background: linear-gradient(135deg, var(--success), #059669);
            border-color: var(--success);
            cursor: default;
            opacity: 0.9;
        }

        .game-card.matched:hover {
            transform: none;
            box-shadow: none;
        }

        .game-card.wrong {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            border-color: var(--danger);
            animation: shake 0.4s var(--ease-smooth);
        }

        /* ==================== è´ªåƒè›‡æ¸¸æˆ ==================== */
        .snake-board {
            grid-template-columns: repeat(15, 1fr);
            max-width: 450px;
        }

        .snake-cell {
            aspect-ratio: 1;
            background: var(--bg-dark-2);
            border-radius: 2px;
            transition: all 0.1s var(--ease-smooth);
        }

        body.light .snake-cell {
            background: var(--bg-light-2);
        }

        .snake-cell.snake {
            background: linear-gradient(135deg, var(--success), #059669);
            border-radius: 2px;
        }

        .snake-cell.snake-head {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            border-radius: 3px;
        }

        .snake-cell.food {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            border-radius: 50%;
            animation: pulse 1s var(--ease-smooth) infinite;
        }

        .snake-cell.wall {
            background: var(--danger);
            border-radius: 2px;
        }

        /* ==================== æ¨ç®±å­æ¸¸æˆ ==================== */
        .sokoban-board {
            grid-template-columns: repeat(8, 1fr);
            max-width: 400px;
        }

        .sokoban-cell {
            aspect-ratio: 1;
            background: var(--bg-dark-2);
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            transition: all 0.1s var(--ease-smooth);
        }

        body.light .sokoban-cell {
            background: var(--bg-light-2);
        }

        .sokoban-cell.wall {
            background: var(--danger);
            border-radius: 2px;
        }

        .sokoban-cell.floor {
            background: var(--bg-dark-3);
        }

        body.light .sokoban-cell.floor {
            background: var(--bg-light-3);
        }

        .sokoban-cell.target {
            background: var(--warning);
            border-radius: 50%;
            opacity: 0.6;
        }

        .sokoban-cell.box {
            background: var(--success);
            border-radius: 3px;
        }

        .sokoban-cell.box-on-target {
            background: var(--primary);
            border-radius: 3px;
        }

        .sokoban-cell.player {
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 1s var(--ease-smooth) infinite;
        }

        /* ==================== å“åº”å¼è®¾è®¡ ==================== */
        @media (max-width: 768px) {
            body {
                padding: var(--space-md);
            }

            .clock {
                font-size: 3.5rem;
            }

            .date-display {
                font-size: 1rem;
            }

            .header {
                flex-direction: column;
                gap: var(--space-md);
                padding: var(--space-md);
            }

            .header-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .stats-bar {
                grid-template-columns: 1fr;
            }

            .expense-inputs {
                flex-direction: column;
            }

            .expense-inputs input:first-child {
                flex: 1;
            }

            .clock-section {
                padding: var(--space-2xl) var(--space-lg);
            }

            .card {
                padding: var(--space-lg);
            }

            .game-board {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .clock {
                font-size: 2.5rem;
            }

            .btn {
                padding: var(--space-xs) var(--space-md);
                font-size: 0.8rem;
            }

            .section-title {
                font-size: 1rem;
            }

            .stat-value {
                font-size: 1rem;
            }

            .game-tabs .btn {
                min-width: 100px;
                font-size: 0.8rem;
            }

            .snake-board {
                grid-template-columns: repeat(12, 1fr);
                max-width: 360px;
            }

            .sokoban-board {
                grid-template-columns: repeat(6, 1fr);
                max-width: 300px;
            }

            .game-card {
                font-size: 1.4rem;
            }

            .sokoban-cell {
                font-size: 1rem;
            }
        }

        /* ==================== åŠ¨ç”»ç³»ç»Ÿ ==================== */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        /* ==================== é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ ==================== */
        @media (prefers-contrast: high) {
            .btn,
            .day,
            .item,
            .game-card,
            .snake-cell,
            .sokoban-cell {
                border-width: 2px;
            }
        }

        /* ==================== å‡å°‘åŠ¨ç”»æ¨¡å¼æ”¯æŒ ==================== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ==================== æ‰“å°æ ·å¼ ==================== */
        @media print {
            .header-actions,
            .calendar-nav,
            .item-delete,
            .input-group,
            .btn,
            .stats-bar,
            .game-section {
                display: none !important;
            }

            .clock-section {
                page-break-after: avoid;
                background: white !important;
                border: 1px solid #ccc !important;
            }

            .item {
                page-break-inside: avoid;
                background: white !important;
                border: 1px solid #ccc !important;
                color: black !important;
            }

            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="header" role="banner">
            <div class="header-title">
                <span aria-hidden="true">â±ï¸</span>
                <span>Chronos</span>
            </div>
            <div class="header-actions">
                <button class="btn" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
                    <span aria-hidden="true">ğŸŒ“</span> ä¸»é¢˜
                </button>
            </div>
        </header>

        <!-- æ—¶é’ŸåŒºåŸŸ -->
        <section class="clock-section" aria-label="å½“å‰æ—¶é—´">
            <div class="clock" id="clock" aria-live="polite">00:00:00</div>
            <div class="date-display" id="dateDisplay" aria-live="polite">åŠ è½½ä¸­...</div>
        </section>

        <!-- ä¸»å†…å®¹ -->
        <main class="main-grid">
            <!-- æ—¥å† -->
            <section class="card calendar" aria-label="æ—¥å†">
                <div class="calendar-header">
                    <div class="calendar-title" id="calendarTitle" aria-live="polite">YYYYå¹´MMæœˆ</div>
                    <div class="calendar-nav">
                        <button id="prevMonth" aria-label="ä¸Šä¸ªæœˆ"><</button>
                        <button id="nextMonth" aria-label="ä¸‹ä¸ªæœˆ">></button>
                    </div>
                </div>
                <div class="calendar-grid" role="grid" aria-label="æ—¥å†ç½‘æ ¼">
                    <div class="day-header" role="columnheader">æ—¥</div>
                    <div class="day-header" role="columnheader">ä¸€</div>
                    <div class="day-header" role="columnheader">äºŒ</div>
                    <div class="day-header" role="columnheader">ä¸‰</div>
                    <div class="day-header" role="columnheader">å››</div>
                    <div class="day-header" role="columnheader">äº”</div>
                    <div class="day-header" role="columnheader">å…­</div>
                </div>
                <div class="calendar-grid" id="calendarDays" role="grid" aria-label="æ—¥æœŸé€‰æ‹©"></div>
            </section>

            <!-- æ•°æ® -->
            <section class="card data-section" aria-label="æ•°æ®ç®¡ç†">
                <!-- è®°äº‹ -->
                <div class="section-title">
                    <span aria-hidden="true">ğŸ“</span>
                    <span>è®°äº‹æœ¬</span>
                </div>
                <div class="input-group">
                    <label for="noteInput">è®°äº‹å†…å®¹</label>
                    <textarea 
                        id="noteInput" 
                        placeholder="åœ¨æ­¤è¾“å…¥è®°äº‹å†…å®¹..."
                        aria-label="è®°äº‹å†…å®¹è¾“å…¥æ¡†"
                        rows="3"
                    ></textarea>
                </div>
                <button class="btn btn-primary" id="saveNote" style="width: 100%;" aria-label="ä¿å­˜è®°äº‹">
                    ä¿å­˜è®°äº‹
                </button>
                <div class="items-list" id="notesList" role="list" aria-label="è®°äº‹åˆ—è¡¨"></div>

                <!-- æ¶ˆè´¹ -->
                <div class="section-title" style="margin-top: 25px;">
                    <span aria-hidden="true">ğŸ’°</span>
                    <span>æ¶ˆè´¹è®°å½•</span>
                </div>
                <div class="input-group">
                    <label for="expenseAmount">æ¶ˆè´¹ä¿¡æ¯</label>
                    <div class="expense-inputs">
                        <input 
                            type="number" 
                            id="expenseAmount" 
                            placeholder="é‡‘é¢" 
                            step="0.01" 
                            min="0"
                            aria-label="æ¶ˆè´¹é‡‘é¢"
                        >
                        <input 
                            type="text" 
                            id="expenseDesc" 
                            placeholder="æè¿°"
                            aria-label="æ¶ˆè´¹æè¿°"
                        >
                    </div>
                </div>
                <button class="btn btn-primary" id="saveExpense" style="width: 100%;" aria-label="è®°å½•æ¶ˆè´¹">
                    è®°å½•æ¶ˆè´¹
                </button>
                <div class="items-list" id="expensesList" role="list" aria-label="æ¶ˆè´¹åˆ—è¡¨"></div>

                <!-- ç»Ÿè®¡ -->
                <div class="stats-bar" role="region" aria-label="æ¶ˆè´¹ç»Ÿè®¡">
                    <div class="stat-item">
                        <div class="stat-label">æœ¬æ—¥æ¶ˆè´¹</div>
                        <div class="stat-value" id="todayExpense" aria-live="polite">Â¥0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æœ¬æœˆæ¶ˆè´¹</div>
                        <div class="stat-value" id="monthExpense" aria-live="polite">Â¥0.00</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¹³å‡æ¯æ—¥</div>
                        <div class="stat-value" id="avgExpense" aria-live="polite">Â¥0.00</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- æ¸¸æˆåŒºåŸŸ -->
        <section class="card game-section" aria-label="å°æ¸¸æˆ">
            <div class="section-title">
                <span aria-hidden="true">ğŸ®</span>
                <span>å°æ¸¸æˆ</span>
            </div>
            
            <!-- æ¸¸æˆåˆ‡æ¢æŒ‰é’® -->
            <div class="game-tabs">
                <button class="btn btn-primary" id="tabMemory" aria-label="åˆ‡æ¢åˆ°è®°å¿†ç¿»ç‰Œæ¸¸æˆ">è®°å¿†ç¿»ç‰Œ</button>
                <button class="btn btn-secondary" id="tabSnake" aria-label="åˆ‡æ¢åˆ°è´ªåƒè›‡æ¸¸æˆ">è´ªåƒè›‡</button>
                <button class="btn btn-secondary" id="tabSokoban" aria-label="åˆ‡æ¢åˆ°æ¨ç®±å­æ¸¸æˆ">æ¨ç®±å­</button>
            </div>

            <!-- è®°å¿†ç¿»ç‰Œæ¸¸æˆ -->
            <div id="memoryGameContainer" class="game-container">
                <div class="game-info">
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-label">æ­¥æ•°</div>
                            <div class="stat-value" id="gameMoves">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ—¶é—´</div>
                            <div class="stat-value" id="gameTime">0s</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æœ€ä½³</div>
                            <div class="stat-value" id="gameBest">--</div>
                        </div>
                    </div>
                    <div class="game-controls">
                        <button class="btn btn-primary" id="startGame" aria-label="å¼€å§‹æ¸¸æˆ">å¼€å§‹æ¸¸æˆ</button>
                        <button class="btn btn-secondary" id="resetGame" aria-label="é‡ç½®æ¸¸æˆ">é‡ç½®</button>
                    </div>
                </div>
                <div class="game-board memory-board" id="gameBoard" role="grid" aria-label="æ¸¸æˆæ¿"></div>
                <div class="game-message" id="gameMessage"></div>
            </div>

            <!-- è´ªåƒè›‡æ¸¸æˆ -->
            <div id="snakeGameContainer" class="game-container" style="display: none;">
                <div class="game-info">
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-label">å¾—åˆ†</div>
                            <div class="stat-value" id="snakeScore">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">é•¿åº¦</div>
                            <div class="stat-value" id="snakeLength">1</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æœ€ä½³</div>
                            <div class="stat-value" id="snakeBest">--</div>
                        </div>
                    </div>
                    <div class="game-controls">
                        <button class="btn btn-primary" id="startSnake" aria-label="å¼€å§‹è´ªåƒè›‡æ¸¸æˆ">å¼€å§‹æ¸¸æˆ</button>
                        <button class="btn btn-secondary" id="resetSnake" aria-label="é‡ç½®è´ªåƒè›‡æ¸¸æˆ">é‡ç½®</button>
                    </div>
                </div>
                <div class="game-board snake-board" id="snakeBoard" role="grid" aria-label="è´ªåƒè›‡æ¸¸æˆæ¿"></div>
                <div class="game-message" id="snakeMessage"></div>
                <div style="text-align: center; color: var(--text-dark-secondary); font-size: 0.85rem; margin-top: 10px;">
                    ä½¿ç”¨æ–¹å‘é”®æˆ–WASDæ§åˆ¶è›‡çš„ç§»åŠ¨
                </div>
            </div>

            <!-- æ¨ç®±å­æ¸¸æˆ -->
            <div id="sokobanGameContainer" class="game-container" style="display: none;">
                <div class="game-info">
                    <div class="game-stats">
                        <div class="stat-item">
                            <div class="stat-label">å…³å¡</div>
                            <div class="stat-value" id="sokobanLevel">1</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æ­¥æ•°</div>
                            <div class="stat-value" id="sokobanMoves">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">æœ€ä½³</div>
                            <div class="stat-value" id="sokobanBest">--</div>
                        </div>
                    </div>
                    <div class="game-controls">
                        <button class="btn btn-primary" id="startSokoban" aria-label="å¼€å§‹æ¨ç®±å­æ¸¸æˆ">å¼€å§‹æ¸¸æˆ</button>
                        <button class="btn btn-secondary" id="resetSokoban" aria-label="é‡ç½®æ¨ç®±å­æ¸¸æˆ">é‡ç½®</button>
                        <button class="btn btn-secondary" id="nextLevel" aria-label="ä¸‹ä¸€å…³">ä¸‹ä¸€å…³</button>
                    </div>
                </div>
                <div class="game-board sokoban-board" id="sokobanBoard" role="grid" aria-label="æ¨ç®±å­æ¸¸æˆæ¿"></div>
                <div class="game-message" id="sokobanMessage"></div>
                <div style="text-align: center; color: var(--text-dark-secondary); font-size: 0.85rem; margin-top: 10px;">
                    ä½¿ç”¨æ–¹å‘é”®ç§»åŠ¨ï¼Œå°†æ‰€æœ‰ç®±å­æ¨åˆ°ç›®æ ‡ä½ç½®
                </div>
            </div>
        </section>

        <!-- æç¤ºä¿¡æ¯ -->
        <footer style="text-align: center; padding: 20px; color: var(--text-dark-secondary); font-size: 0.9rem;" role="contentinfo">
            ğŸ’¡ Chronos - é«˜çº§æ—¶é’Ÿåº”ç”¨
        </footer>
    </div>

    <script type="module">
        // ==================== é…ç½®æ¨¡å— ====================
        const CONFIG = {
            STORAGE_KEYS: {
                NOTES: 'clock_notes',
                EXPENSES: 'clock_expenses',
                THEME: 'clock_theme'
            },
            UPDATE_INTERVAL: 1000,
            DEBOUNCE_DELAY: 300,
            GAME_CONFIG: {
                MEMORY: {
                    icons: ['â™ ', 'â™¥', 'â™¦', 'â™£', 'â˜…', 'â—†', 'â—', 'â– '],
                    boardSize: 4
                },
                SNAKE: {
                    boardSize: 15,
                    initialSpeed: 120,
                    speedIncrement: 8,
                    scorePerFood: 10,
                    speedUpThreshold: 50
                },
                SOKOBAN: {
                    boardSize: 8,
                    levels: [
                        {
                            map: [
                                [1,1,1,1,1,1,1,1],
                                [1,0,0,0,0,0,0,1],
                                [1,0,2,0,0,0,0,1],
                                [1,0,0,0,3,0,0,1],
                                [1,0,0,0,4,0,0,1],
                                [1,0,0,0,0,0,0,1],
                                [1,0,0,0,0,0,0,1],
                                [1,1,1,1,1,1,1,1]
                            ],
                            player: { x: 4, y: 4 },
                            boxes: [{ x: 2, y: 2 }],
                            targets: [{ x: 4, y: 3 }]
                        },
                        {
                            map: [
                                [1,1,1,1,1,1,1,1],
                                [1,1,1,0,0,1,1,1],
                                [1,1,1,2,0,1,1,1],
                                [1,0,0,3,0,0,0,1],
                                [1,0,0,2,4,0,0,1],
                                [1,0,0,3,0,0,0,1],
                                [1,1,1,1,1,1,1,1],
                                [1,1,1,1,1,1,1,1]
                            ],
                            player: { x: 4, y: 4 },
                            boxes: [{ x: 3, y: 2 }, { x: 3, y: 4 }],
                            targets: [{ x: 3, y: 3 }, { x: 3, y: 5 }]
                        },
                        {
                            map: [
                                [1,1,1,1,1,1,1,1],
                                [1,0,0,0,0,0,0,1],
                                [1,0,2,0,2,0,0,1],
                                [1,0,0,1,0,0,0,1],
                                [1,0,3,0,3,0,0,1],
                                [1,0,0,0,4,0,0,1],
                                [1,0,0,0,0,0,0,1],
                                [1,1,1,1,1,1,1,1]
                            ],
                            player: { x: 4, y: 5 },
                            boxes: [{ x: 2, y: 2 }, { x: 4, y: 2 }],
                            targets: [{ x: 2, y: 4 }, { x: 4, y: 4 }]
                        }
                    ]
                }
            }
        };

        // ==================== å·¥å…·å‡½æ•°æ¨¡å— ====================
        const Utils = {
            formatDate(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            },

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
            },

            formatCurrency(amount) {
                return `Â¥${Number(amount).toFixed(2)}`;
            },

            getCurrentTimestamp() {
                return new Date().toISOString();
            },

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            throttle(func, limit) {
                let inThrottle;
                return function(...args) {
                    if (!inThrottle) {
                        func.apply(this, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            }
        };

        // ==================== æ•°æ®ç®¡ç†æ¨¡å— ====================
        const DataManager = {
            getData(key, defaultValue = {}) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.warn(`Failed to read from localStorage: ${key}`, error);
                    return defaultValue;
                }
            },

            setData(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error(`Failed to write to localStorage: ${key}`, error);
                    if (error.name === 'QuotaExceededError') {
                        alert('å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œè¯·æ¸…ç†ä¸€äº›æ—§æ•°æ®');
                    }
                    return false;
                }
            },

            addItem(key, dateKey, item) {
                const data = this.getData(key, {});
                if (!data[dateKey]) data[dateKey] = [];
                data[dateKey].push(item);
                data[dateKey].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                this.setData(key, data);
                return data;
            },

            deleteItem(key, dateKey, itemId) {
                const data = this.getData(key, {});
                if (data[dateKey]) {
                    data[dateKey] = data[dateKey].filter(item => item.id !== itemId);
                    if (data[dateKey].length === 0) delete data[dateKey];
                    this.setData(key, data);
                }
                return data;
            },

            getItems(key, dateKey) {
                const data = this.getData(key, {});
                return data[dateKey] || [];
            },

            getStats(selectedDate) {
                const expenses = this.getData(CONFIG.STORAGE_KEYS.EXPENSES, {});
                const dateKey = Utils.formatDate(selectedDate);
                const year = selectedDate.getFullYear();
                const month = selectedDate.getMonth();

                const todayExpense = expenses[dateKey]?.reduce((sum, e) => sum + e.amount, 0) || 0;

                let monthExpense = 0;
                let expenseDays = 0;
                
                Object.keys(expenses).forEach(key => {
                    const d = new Date(key);
                    if (d.getFullYear() === year && d.getMonth() === month) {
                        monthExpense += expenses[key].reduce((sum, e) => sum + e.amount, 0);
                        expenseDays++;
                    }
                });

                const avgExpense = expenseDays > 0 ? monthExpense / expenseDays : 0;

                return { todayExpense, monthExpense, avgExpense };
            },

            cleanupOldData() {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

                const cleanupKey = (key) => {
                    const data = this.getData(key, {});
                    const cleanedData = {};

                    Object.keys(data).forEach(dateKey => {
                        const date = new Date(dateKey);
                        if (date >= thirtyDaysAgo) {
                            cleanedData[dateKey] = data[dateKey];
                        }
                    });

                    if (Object.keys(cleanedData).length < Object.keys(data).length) {
                        this.setData(key, cleanedData);
                        console.log(`Cleaned up old data for ${key}`);
                    }
                };

                cleanupKey(CONFIG.STORAGE_KEYS.NOTES);
                cleanupKey(CONFIG.STORAGE_KEYS.EXPENSES);
            }
        };

        // ==================== æ¸¸æˆæ¨¡å— ====================
        class MemoryGame {
            constructor() {
                this.cards = [];
                this.flippedCards = [];
                this.matchedPairs = 0;
                this.moves = 0;
                this.gameTime = 0;
                this.gameInterval = null;
                this.isGameActive = false;
                this.canFlip = true;
                this.storageKey = 'clock_game_best';
                this.icons = CONFIG.GAME_CONFIG.MEMORY.icons;
            }

            init() {
                this.loadBestScore();
                this.setupEventListeners();
                this.renderBoard();
                this.updateStats();
            }

            setupEventListeners() {
                const startBtn = document.getElementById('startGame');
                const resetBtn = document.getElementById('resetGame');

                if (startBtn) {
                    startBtn.addEventListener('click', () => this.startGame());
                }

                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetGame());
                }
            }

            startGame() {
                if (this.isGameActive) return;

                this.isGameActive = true;
                this.moves = 0;
                this.matchedPairs = 0;
                this.gameTime = 0;
                this.flippedCards = [];
                this.canFlip = true;

                const gameIcons = this.icons.slice(0, 8);
                this.cards = [...gameIcons, ...gameIcons]
                    .sort(() => Math.random() - 0.5)
                    .map((icon, index) => ({
                        id: index,
                        icon: icon,
                        isFlipped: false,
                        isMatched: false
                    }));

                this.renderBoard();
                this.updateStats();
                this.showMessage('æ¸¸æˆå¼€å§‹ï¼æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„å¡ç‰‡', 'info');
                this.startTimer();
            }

            resetGame() {
                this.stopTimer();
                this.isGameActive = false;
                this.moves = 0;
                this.gameTime = 0;
                this.matchedPairs = 0;
                this.flippedCards = [];
                this.canFlip = true;
                this.cards = [];

                this.renderBoard();
                this.updateStats();
                this.showMessage('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹æŒ‘æˆ˜ï¼', 'info');
            }

            startTimer() {
                this.stopTimer();
                this.gameInterval = setInterval(() => {
                    this.gameTime++;
                    this.updateStats();
                }, 1000);
            }

            stopTimer() {
                if (this.gameInterval) {
                    clearInterval(this.gameInterval);
                    this.gameInterval = null;
                }
            }

            renderBoard() {
                const board = document.getElementById('gameBoard');
                if (!board) return;

                if (this.cards.length === 0) {
                    board.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-dark-secondary);">ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹æŒ‘æˆ˜</div>';
                    return;
                }

                const fragment = document.createDocumentFragment();
                this.cards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'game-card';
                    cardElement.setAttribute('role', 'gridcell');
                    cardElement.setAttribute('tabindex', '0');
                    cardElement.setAttribute('aria-label', 'æ¸¸æˆå¡ç‰‡');
                    
                    if (card.isFlipped || card.isMatched) {
                        cardElement.classList.add('flipped');
                        cardElement.textContent = card.icon;
                    } else {
                        cardElement.textContent = '';
                    }

                    if (card.isMatched) {
                        cardElement.classList.add('matched');
                    }

                    if (!card.isMatched && !card.isFlipped) {
                        cardElement.addEventListener('click', () => this.flipCard(card.id));
                        cardElement.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter' || e.key === ' ') {
                                e.preventDefault();
                                this.flipCard(card.id);
                            }
                        });
                    }

                    fragment.appendChild(cardElement);
                });

                board.innerHTML = '';
                board.appendChild(fragment);
            }

            flipCard(cardId) {
                if (!this.isGameActive || !this.canFlip) return;

                const card = this.cards.find(c => c.id === cardId);
                if (!card || card.isFlipped || card.isMatched) return;

                card.isFlipped = true;
                this.flippedCards.push(card);
                this.renderBoard();

                if (this.flippedCards.length === 2) {
                    this.moves++;
                    this.updateStats();
                    this.canFlip = false;
                    
                    setTimeout(() => this.checkMatch(), 400);
                }
            }

            checkMatch() {
                const [card1, card2] = this.flippedCards;

                if (card1.icon === card2.icon) {
                    card1.isMatched = true;
                    card2.isMatched = true;
                    this.matchedPairs++;
                    this.flippedCards = [];
                    this.canFlip = true;

                    this.renderBoard();
                    this.showMessage(`åŒ¹é…æˆåŠŸï¼(${this.matchedPairs}/8)`, 'success');

                    if (this.matchedPairs === 8) {
                        this.gameWon();
                    }
                } else {
                    const cardElements = document.querySelectorAll('.game-card');
                    const indices = [card1.id, card2.id];
                    
                    indices.forEach(index => {
                        const element = cardElements[index];
                        if (element) {
                            element.classList.add('wrong');
                        }
                    });

                    setTimeout(() => {
                        card1.isFlipped = false;
                        card2.isFlipped = false;
                        this.flippedCards = [];
                        this.canFlip = true;
                        this.renderBoard();
                        this.showMessage('å†è¯•ä¸€æ¬¡ï¼', 'warning');
                    }, 600);
                }
            }

            gameWon() {
                this.stopTimer();
                this.isGameActive = false;

                const bestScore = this.getBestScore();
                const isNewRecord = !bestScore || this.moves < bestScore.moves || 
                                   (this.moves === bestScore.moves && this.gameTime < bestScore.time);

                if (isNewRecord) {
                    this.saveBestScore();
                    this.showMessage(`ğŸ‰ æ­å–œï¼æ–°çºªå½•ï¼æ­¥æ•°ï¼š${this.moves}ï¼Œæ—¶é—´ï¼š${this.gameTime}ç§’`, 'success');
                } else {
                    this.showMessage(`ğŸ‰ æ¸¸æˆèƒœåˆ©ï¼æ­¥æ•°ï¼š${this.moves}ï¼Œæ—¶é—´ï¼š${this.gameTime}ç§’`, 'success');
                }

                this.updateStats();
            }

            updateStats() {
                const movesElement = document.getElementById('gameMoves');
                const timeElement = document.getElementById('gameTime');
                const bestElement = document.getElementById('gameBest');

                if (movesElement) movesElement.textContent = this.moves;
                if (timeElement) timeElement.textContent = `${this.gameTime}s`;

                const bestScore = this.getBestScore();
                if (bestElement && bestScore) {
                    bestElement.textContent = `${bestScore.moves}æ­¥/${bestScore.time}ç§’`;
                } else if (bestElement) {
                    bestElement.textContent = '--';
                }
            }

            showMessage(text, type = 'info') {
                const messageElement = document.getElementById('gameMessage');
                if (!messageElement) return;

                messageElement.textContent = text;
                messageElement.className = `game-message ${type}`;
            }

            getBestScore() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.warn('Failed to load best score:', error);
                    return null;
                }
            }

            saveBestScore() {
                try {
                    const bestScore = {
                        moves: this.moves,
                        time: this.gameTime,
                        date: new Date().toISOString()
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(bestScore));
                } catch (error) {
                    console.warn('Failed to save best score:', error);
                }
            }

            loadBestScore() {
                // å·²åœ¨getBestScoreä¸­å¤„ç†
            }

            destroy() {
                this.stopTimer();
            }
        }

        class SnakeGame {
            constructor() {
                this.boardSize = CONFIG.GAME_CONFIG.SNAKE.boardSize;
                this.snake = [];
                this.direction = { x: 1, y: 0 };
                this.nextDirection = { x: 1, y: 0 };
                this.food = null;
                this.score = 0;
                this.gameInterval = null;
                this.gameSpeed = CONFIG.GAME_CONFIG.SNAKE.initialSpeed;
                this.isGameActive = false;
                this.storageKey = 'clock_snake_best';
            }

            init() {
                this.loadBestScore();
                this.setupEventListeners();
                this.renderBoard();
                this.updateStats();
            }

            setupEventListeners() {
                const startBtn = document.getElementById('startSnake');
                const resetBtn = document.getElementById('resetSnake');

                if (startBtn) {
                    startBtn.addEventListener('click', () => this.startGame());
                }

                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetGame());
                }

                document.addEventListener('keydown', (e) => {
                    if (!this.isGameActive) return;

                    const key = e.key.toLowerCase();
                    const newDirection = { ...this.nextDirection };

                    switch(key) {
                        case 'arrowup':
                        case 'w':
                            if (this.direction.y === 0) {
                                newDirection.x = 0;
                                newDirection.y = -1;
                            }
                            break;
                        case 'arrowdown':
                        case 's':
                            if (this.direction.y === 0) {
                                newDirection.x = 0;
                                newDirection.y = 1;
                            }
                            break;
                        case 'arrowleft':
                        case 'a':
                            if (this.direction.x === 0) {
                                newDirection.x = -1;
                                newDirection.y = 0;
                            }
                            break;
                        case 'arrowright':
                        case 'd':
                            if (this.direction.x === 0) {
                                newDirection.x = 1;
                                newDirection.y = 0;
                            }
                            break;
                    }

                    this.nextDirection = newDirection;
                });
            }

            startGame() {
                if (this.isGameActive) return;

                this.isGameActive = true;
                this.score = 0;
                this.direction = { x: 1, y: 0 };
                this.nextDirection = { x: 1, y: 0 };
                this.gameSpeed = CONFIG.GAME_CONFIG.SNAKE.initialSpeed;

                this.snake = [
                    { x: 7, y: 7 },
                    { x: 6, y: 7 },
                    { x: 5, y: 7 }
                ];

                this.spawnFood();
                this.renderBoard();
                this.updateStats();
                this.showMessage('æ¸¸æˆå¼€å§‹ï¼ä½¿ç”¨æ–¹å‘é”®æˆ–WASDæ§åˆ¶', 'info');
                this.startTimer();
            }

            resetGame() {
                this.stopTimer();
                this.isGameActive = false;
                this.score = 0;
                this.snake = [];
                this.direction = { x: 1, y: 0 };
                this.nextDirection = { x: 1, y: 0 };
                this.food = null;

                this.renderBoard();
                this.updateStats();
                this.showMessage('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹æŒ‘æˆ˜ï¼', 'info');
            }

            startTimer() {
                this.stopTimer();
                this.gameInterval = setInterval(() => {
                    this.update();
                }, this.gameSpeed);
            }

            stopTimer() {
                if (this.gameInterval) {
                    clearInterval(this.gameInterval);
                    this.gameInterval = null;
                }
            }

            spawnFood() {
                let newFood;
                do {
                    newFood = {
                        x: Math.floor(Math.random() * this.boardSize),
                        y: Math.floor(Math.random() * this.boardSize)
                    };
                } while (this.snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
                
                this.food = newFood;
            }

            update() {
                if (!this.isGameActive) return;

                this.direction = { ...this.nextDirection };

                const head = { ...this.snake[0] };
                head.x += this.direction.x;
                head.y += this.direction.y;

                if (head.x < 0 || head.x >= this.boardSize || head.y < 0 || head.y >= this.boardSize) {
                    this.gameOver();
                    return;
                }

                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver();
                    return;
                }

                this.snake.unshift(head);

                if (this.food && head.x === this.food.x && head.y === this.food.y) {
                    this.score += CONFIG.GAME_CONFIG.SNAKE.scorePerFood;
                    this.spawnFood();
                    
                    if (this.score % CONFIG.GAME_CONFIG.SNAKE.speedUpThreshold === 0 && this.gameSpeed > 50) {
                        this.gameSpeed -= CONFIG.GAME_CONFIG.SNAKE.speedIncrement;
                        this.startTimer();
                    }
                } else {
                    this.snake.pop();
                }

                this.renderBoard();
                this.updateStats();
            }

            renderBoard() {
                const board = document.getElementById('snakeBoard');
                if (!board) return;

                const fragment = document.createDocumentFragment();
                for (let y = 0; y < this.boardSize; y++) {
                    for (let x = 0; x < this.boardSize; x++) {
                        const cell = document.createElement('div');
                        cell.className = 'snake-cell';
                        cell.setAttribute('role', 'gridcell');
                        cell.setAttribute('aria-label', `ä½ç½® ${x},${y}`);

                        const isSnake = this.snake.some(segment => segment.x === x && segment.y === y);
                        const isHead = this.snake.length > 0 && this.snake[0].x === x && this.snake[0].y === y;
                        const isFood = this.food && this.food.x === x && this.food.y === y;

                        if (isHead) {
                            cell.classList.add('snake-head');
                        } else if (isSnake) {
                            cell.classList.add('snake');
                        } else if (isFood) {
                            cell.classList.add('food');
                        }

                        fragment.appendChild(cell);
                    }
                }

                board.innerHTML = '';
                board.appendChild(fragment);
            }

            updateStats() {
                const scoreElement = document.getElementById('snakeScore');
                const lengthElement = document.getElementById('snakeLength');
                const bestElement = document.getElementById('snakeBest');

                if (scoreElement) scoreElement.textContent = this.score;
                if (lengthElement) lengthElement.textContent = this.snake.length;

                const bestScore = this.getBestScore();
                if (bestElement && bestScore) {
                    bestElement.textContent = `${bestScore.score}åˆ†/${bestScore.length}èŠ‚`;
                } else if (bestElement) {
                    bestElement.textContent = '--';
                }
            }

            showMessage(text, type = 'info') {
                const messageElement = document.getElementById('snakeMessage');
                if (!messageElement) return;

                messageElement.textContent = text;
                messageElement.className = `game-message ${type}`;
            }

            gameOver() {
                this.stopTimer();
                this.isGameActive = false;

                const bestScore = this.getBestScore();
                const isNewRecord = !bestScore || this.score > bestScore.score;

                if (isNewRecord) {
                    this.saveBestScore();
                    this.showMessage(`ğŸ’€ æ¸¸æˆç»“æŸï¼æ–°çºªå½•ï¼å¾—åˆ†ï¼š${this.score}ï¼Œé•¿åº¦ï¼š${this.snake.length}èŠ‚`, 'success');
                } else {
                    this.showMessage(`ğŸ’€ æ¸¸æˆç»“æŸï¼å¾—åˆ†ï¼š${this.score}ï¼Œé•¿åº¦ï¼š${this.snake.length}èŠ‚`, 'warning');
                }

                this.updateStats();
            }

            getBestScore() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.warn('Failed to load snake best score:', error);
                    return null;
                }
            }

            saveBestScore() {
                try {
                    const bestScore = {
                        score: this.score,
                        length: this.snake.length,
                        date: new Date().toISOString()
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(bestScore));
                } catch (error) {
                    console.warn('Failed to save snake best score:', error);
                }
            }

            loadBestScore() {
                // å·²åœ¨getBestScoreä¸­å¤„ç†
            }

            destroy() {
                this.stopTimer();
            }
        }

        class SokobanGame {
            constructor() {
                this.boardSize = CONFIG.GAME_CONFIG.SOKOBAN.boardSize;
                this.currentLevel = 1;
                this.moves = 0;
                this.gameInterval = null;
                this.isGameActive = false;
                this.storageKey = 'clock_sokoban_best';
                this.levels = CONFIG.GAME_CONFIG.SOKOBAN.levels;
            }

            init() {
                this.loadBestScore();
                this.setupEventListeners();
                this.renderBoard();
                this.updateStats();
            }

            setupEventListeners() {
                const startBtn = document.getElementById('startSokoban');
                const resetBtn = document.getElementById('resetSokoban');
                const nextBtn = document.getElementById('nextLevel');

                if (startBtn) {
                    startBtn.addEventListener('click', () => this.startGame());
                }

                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetGame());
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', () => this.nextLevel());
                }

                document.addEventListener('keydown', (e) => {
                    if (!this.isGameActive) return;

                    const key = e.key.toLowerCase();
                    let dx = 0, dy = 0;

                    switch(key) {
                        case 'arrowup':
                        case 'w':
                            dy = -1;
                            break;
                        case 'arrowdown':
                        case 's':
                            dy = 1;
                            break;
                        case 'arrowleft':
                        case 'a':
                            dx = -1;
                            break;
                        case 'arrowright':
                        case 'd':
                            dx = 1;
                            break;
                        default:
                            return;
                    }

                    e.preventDefault();
                    this.movePlayer(dx, dy);
                });
            }

            startGame() {
                if (this.isGameActive) return;

                this.isGameActive = true;
                this.moves = 0;
                this.currentLevel = 1;

                this.renderBoard();
                this.updateStats();
                this.showMessage('æ¸¸æˆå¼€å§‹ï¼ä½¿ç”¨æ–¹å‘é”®æˆ–WASDç§»åŠ¨', 'info');
            }

            resetGame() {
                this.isGameActive = false;
                this.moves = 0;
                this.currentLevel = 1;

                this.renderBoard();
                this.updateStats();
                this.showMessage('ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹æŒ‘æˆ˜ï¼', 'info');
            }

            nextLevel() {
                if (!this.isGameActive) {
                    this.showMessage('è¯·å…ˆå¼€å§‹æ¸¸æˆï¼', 'warning');
                    return;
                }

                if (this.currentLevel < this.levels.length) {
                    this.currentLevel++;
                    this.moves = 0;
                    this.renderBoard();
                    this.updateStats();
                    this.showMessage(`è¿›å…¥ç¬¬${this.currentLevel}å…³ï¼`, 'info');
                } else {
                    this.showMessage('ğŸ‰ æ­å–œï¼ä½ å·²å®Œæˆæ‰€æœ‰å…³å¡ï¼', 'success');
                }
            }

            movePlayer(dx, dy) {
                const level = this.levels[this.currentLevel - 1];
                const player = { ...level.player };
                const newPlayer = { x: player.x + dx, y: player.y + dy };

                if (newPlayer.x < 0 || newPlayer.x >= this.boardSize || 
                    newPlayer.y < 0 || newPlayer.y >= this.boardSize) {
                    return;
                }

                if (level.map[newPlayer.y][newPlayer.x] === 1) {
                    return;
                }

                const boxIndex = level.boxes.findIndex(box => box.x === newPlayer.x && box.y === newPlayer.y);
                
                if (boxIndex !== -1) {
                    const newBox = { x: newPlayer.x + dx, y: newPlayer.y + dy };

                    if (newBox.x < 0 || newBox.x >= this.boardSize || 
                        newBox.y < 0 || newBox.y >= this.boardSize) {
                        return;
                    }

                    if (level.map[newBox.y][newBox.x] === 1) {
                        return;
                    }

                    if (level.boxes.some(box => box.x === newBox.x && box.y === newBox.y)) {
                        return;
                    }

                    level.boxes[boxIndex] = newBox;
                }

                level.player = newPlayer;
                this.moves++;

                this.renderBoard();
                this.updateStats();

                if (this.checkWin()) {
                    this.gameWon();
                }
            }

            checkWin() {
                const level = this.levels[this.currentLevel - 1];
                return level.boxes.every(box => 
                    level.targets.some(target => target.x === box.x && target.y === box.y)
                );
            }

            gameWon() {
                this.isGameActive = false;

                const bestScore = this.getBestScore();
                const isNewRecord = !bestScore || this.moves < bestScore.moves;

                if (isNewRecord) {
                    this.saveBestScore();
                    this.showMessage(`ğŸ‰ æ­å–œé€šå…³ï¼æ–°çºªå½•ï¼æ­¥æ•°ï¼š${this.moves}`, 'success');
                } else {
                    this.showMessage(`ğŸ‰ é€šå…³æˆåŠŸï¼æ­¥æ•°ï¼š${this.moves}`, 'success');
                }

                this.updateStats();
            }

            renderBoard() {
                const board = document.getElementById('sokobanBoard');
                if (!board) return;

                if (!this.isGameActive) {
                    board.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-dark-secondary);">ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"å¼€å§‹æŒ‘æˆ˜</div>';
                    return;
                }

                const level = this.levels[this.currentLevel - 1];
                const fragment = document.createDocumentFragment();

                for (let y = 0; y < this.boardSize; y++) {
                    for (let x = 0; x < this.boardSize; x++) {
                        const cell = document.createElement('div');
                        cell.className = 'sokoban-cell';
                        cell.setAttribute('role', 'gridcell');
                        cell.setAttribute('aria-label', `ä½ç½® ${x},${y}`);

                        const isWall = level.map[y][x] === 1;
                        const isTarget = level.targets.some(t => t.x === x && t.y === y);
                        const isBox = level.boxes.some(b => b.x === x && b.y === y);
                        const isPlayer = level.player.x === x && level.player.y === y;

                        if (isWall) {
                            cell.classList.add('wall');
                            cell.textContent = 'â–ˆ';
                        } else if (isPlayer && isTarget) {
                            cell.classList.add('player');
                            cell.textContent = 'â—';
                        } else if (isPlayer) {
                            cell.classList.add('player');
                            cell.textContent = 'â—';
                        } else if (isBox && isTarget) {
                            cell.classList.add('box-on-target');
                            cell.textContent = 'â– ';
                        } else if (isBox) {
                            cell.classList.add('box');
                            cell.textContent = 'â–¡';
                        } else if (isTarget) {
                            cell.classList.add('target');
                            cell.textContent = 'â—‹';
                        } else {
                            cell.classList.add('floor');
                            cell.textContent = '';
                        }

                        fragment.appendChild(cell);
                    }
                }

                board.innerHTML = '';
                board.appendChild(fragment);
            }

            updateStats() {
                const levelElement = document.getElementById('sokobanLevel');
                const movesElement = document.getElementById('sokobanMoves');
                const bestElement = document.getElementById('sokobanBest');

                if (levelElement) levelElement.textContent = this.currentLevel;
                if (movesElement) movesElement.textContent = this.moves;

                const bestScore = this.getBestScore();
                if (bestElement && bestScore) {
                    bestElement.textContent = `${bestScore.moves}æ­¥`;
                } else if (bestElement) {
                    bestElement.textContent = '--';
                }
            }

            showMessage(text, type = 'info') {
                const messageElement = document.getElementById('sokobanMessage');
                if (!messageElement) return;

                messageElement.textContent = text;
                messageElement.className = `game-message ${type}`;
            }

            getBestScore() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.warn('Failed to load sokoban best score:', error);
                    return null;
                }
            }

            saveBestScore() {
                try {
                    const bestScore = {
                        moves: this.moves,
                        level: this.currentLevel,
                        date: new Date().toISOString()
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(bestScore));
                } catch (error) {
                    console.warn('Failed to save sokoban best score:', error);
                }
            }

            loadBestScore() {
                // å·²åœ¨getBestScoreä¸­å¤„ç†
            }

            destroy() {
                // æ¸…ç†èµ„æº
            }
        }

        // ==================== ä¸»åº”ç”¨æ¨¡å— ====================
        class ClockApp {
            constructor() {
                this.selectedDate = new Date();
                this.currentMonth = new Date();
                this.isDarkTheme = true;
                this.clockInterval = null;
                this.isInitialized = false;
                this.memoryGame = null;
                this.snakeGame = null;
                this.sokobanGame = null;
                this.currentGame = 'memory';
                this.init();
            }

            init() {
                if (this.isInitialized) return;

                try {
                    // 1. ç«‹å³åŠ è½½æ ¸å¿ƒåŠŸèƒ½
                    this.loadTheme();
                    this.startClock();
                    
                    // 2. å»¶è¿Ÿæ‰§è¡Œéæ ¸å¿ƒä»»åŠ¡
                    setTimeout(() => {
                        this.setupEventListeners();
                        this.renderCalendar();
                        this.renderData();
                    }, 50);
                    
                    // 3. å»¶è¿Ÿåˆå§‹åŒ–æ¸¸æˆ
                    setTimeout(() => {
                        this.lazyInitGames();
                    }, 300);
                    
                    // 4. å»¶è¿Ÿæ•°æ®æ¸…ç†
                    setTimeout(() => {
                        this.scheduleCleanup();
                    }, 1000);
                    
                    this.isInitialized = true;
                    console.log('Chronos initialized successfully');
                } catch (error) {
                    console.error('Failed to initialize Chronos:', error);
                    this.showError('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            }

            lazyInitGames() {
                if (!this.memoryGame) this.memoryGame = new MemoryGame();
                if (!this.snakeGame) this.snakeGame = new SnakeGame();
                if (!this.sokobanGame) this.sokobanGame = new SokobanGame();
                
                this.memoryGame.init();
                this.snakeGame.init();
                this.sokobanGame.init();
            }

            loadTheme() {
                try {
                    const savedTheme = localStorage.getItem(CONFIG.STORAGE_KEYS.THEME);
                    if (savedTheme) {
                        this.isDarkTheme = savedTheme === 'dark';
                    } else {
                        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                            this.isDarkTheme = false;
                        }
                    }
                    this.applyTheme();
                } catch (error) {
                    console.warn('Failed to load theme:', error);
                }
            }

            applyTheme() {
                document.body.className = this.isDarkTheme ? '' : 'light';
            }

            toggleTheme() {
                this.isDarkTheme = !this.isDarkTheme;
                try {
                    localStorage.setItem(CONFIG.STORAGE_KEYS.THEME, this.isDarkTheme ? 'dark' : 'light');
                } catch (error) {
                    console.warn('Failed to save theme:', error);
                }
                this.applyTheme();
            }

            setupEventListeners() {
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
                document.getElementById('prevMonth').addEventListener('click', () => this.changeMonth(-1));
                document.getElementById('nextMonth').addEventListener('click', () => this.changeMonth(1));
                document.getElementById('saveNote').addEventListener('click', () => this.saveNote());
                document.getElementById('saveExpense').addEventListener('click', () => this.saveExpense());
                document.getElementById('tabMemory').addEventListener('click', () => this.switchGame('memory'));
                document.getElementById('tabSnake').addEventListener('click', () => this.switchGame('snake'));
                document.getElementById('tabSokoban').addEventListener('click', () => this.switchGame('sokoban'));

                document.getElementById('noteInput').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        e.preventDefault();
                        this.saveNote();
                    }
                });

                document.getElementById('expenseAmount').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        document.getElementById('expenseDesc').focus();
                    }
                });

                document.getElementById('expenseDesc').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        e.preventDefault();
                        this.saveExpense();
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.activeElement?.blur();
                    }
                });
            }

            switchGame(gameType) {
                this.currentGame = gameType;
                
                const memoryContainer = document.getElementById('memoryGameContainer');
                const snakeContainer = document.getElementById('snakeGameContainer');
                const sokobanContainer = document.getElementById('sokobanGameContainer');
                const tabMemory = document.getElementById('tabMemory');
                const tabSnake = document.getElementById('tabSnake');
                const tabSokoban = document.getElementById('tabSokoban');

                [tabMemory, tabSnake, tabSokoban].forEach(btn => {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                });

                [memoryContainer, snakeContainer, sokobanContainer].forEach(container => {
                    container.style.display = 'none';
                });

                if (gameType === 'memory') {
                    memoryContainer.style.display = 'flex';
                    tabMemory.classList.add('btn-primary');
                    tabMemory.classList.remove('btn-secondary');
                    this.snakeGame.stopTimer();
                    this.sokobanGame.isGameActive = false;
                } else if (gameType === 'snake') {
                    snakeContainer.style.display = 'flex';
                    tabSnake.classList.add('btn-primary');
                    tabSnake.classList.remove('btn-secondary');
                    this.memoryGame.stopTimer();
                    this.sokobanGame.isGameActive = false;
                } else {
                    sokobanContainer.style.display = 'flex';
                    tabSokoban.classList.add('btn-primary');
                    tabSokoban.classList.remove('btn-secondary');
                    this.memoryGame.stopTimer();
                    this.snakeGame.stopTimer();
                }
            }

            startClock() {
                const update = () => {
                    try {
                        const now = new Date();
                        const hours = String(now.getHours()).padStart(2, '0');
                        const minutes = String(now.getMinutes()).padStart(2, '0');
                        const seconds = String(now.getSeconds()).padStart(2, '0');
                        
                        const clockElement = document.getElementById('clock');
                        const dateElement = document.getElementById('dateDisplay');
                        
                        if (clockElement) {
                            clockElement.textContent = `${hours}:${minutes}:${seconds}`;
                        }
                        
                        if (dateElement) {
                            dateElement.textContent = now.toLocaleDateString('zh-CN', {
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric', 
                                weekday: 'long'
                            });
                        }
                    } catch (error) {
                        console.error('Error updating clock:', error);
                    }
                };

                update();
                this.clockInterval = setInterval(update, CONFIG.UPDATE_INTERVAL);
            }

            stopClock() {
                if (this.clockInterval) {
                    clearInterval(this.clockInterval);
                    this.clockInterval = null;
                }
            }

            changeMonth(delta) {
                this.currentMonth.setMonth(this.currentMonth.getMonth() + delta);
                this.renderCalendar();
            }

            renderCalendar() {
                const year = this.currentMonth.getFullYear();
                const month = this.currentMonth.getMonth();
                
                const titleElement = document.getElementById('calendarTitle');
                if (titleElement) {
                    titleElement.textContent = `${year}å¹´${String(month + 1).padStart(2, '0')}æœˆ`;
                }

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const prevLastDay = new Date(year, month, 0).getDate();
                const startDay = firstDay.getDay();

                const notes = DataManager.getData(CONFIG.STORAGE_KEYS.NOTES, {});
                const expenses = DataManager.getData(CONFIG.STORAGE_KEYS.EXPENSES, {});
                const daysContainer = document.getElementById('calendarDays');
                
                if (!daysContainer) return;

                const fragment = document.createDocumentFragment();

                for (let i = startDay - 1; i >= 0; i--) {
                    const day = this.createDayElement(prevLastDay - i, true);
                    fragment.appendChild(day);
                }

                const today = new Date();
                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const dateKey = Utils.formatDate(new Date(year, month, i));
                    const hasData = (notes[dateKey]?.length > 0) || (expenses[dateKey]?.length > 0);
                    const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === i;
                    const isSelected = this.selectedDate.getFullYear() === year && this.selectedDate.getMonth() === month && this.selectedDate.getDate() === i;
                    
                    const day = this.createDayElement(i, false, hasData, isToday, isSelected);
                    day.addEventListener('click', () => this.selectDate(year, month, i));
                    fragment.appendChild(day);
                }

                const totalCells = 42;
                const remainingCells = totalCells - (startDay + lastDay.getDate());
                for (let i = 1; i <= remainingCells; i++) {
                    const day = this.createDayElement(i, true);
                    fragment.appendChild(day);
                }

                daysContainer.innerHTML = '';
                daysContainer.appendChild(fragment);
            }

            createDayElement(day, isOtherMonth, hasData = false, isToday = false, isSelected = false) {
                const div = document.createElement('div');
                div.className = 'day';
                div.textContent = day;
                div.setAttribute('role', 'gridcell');
                div.setAttribute('tabindex', isOtherMonth ? '-1' : '0');
                
                if (isOtherMonth) {
                    div.classList.add('other-month');
                    div.setAttribute('aria-disabled', 'true');
                } else {
                    div.setAttribute('aria-label', `${day}æ—¥`);
                    if (hasData) {
                        div.classList.add('has-data');
                        div.setAttribute('aria-label', `${day}æ—¥ï¼Œæœ‰æ•°æ®`);
                    }
                    if (isToday) {
                        div.classList.add('today');
                        div.setAttribute('aria-label', `${day}æ—¥ï¼Œä»Šå¤©`);
                    }
                    if (isSelected) {
                        div.classList.add('selected');
                        div.setAttribute('aria-selected', 'true');
                    }
                }

                return div;
            }

            selectDate(year, month, day) {
                this.selectedDate = new Date(year, month, day);
                this.renderCalendar();
                this.renderData();
            }

            renderData() {
                const dateKey = Utils.formatDate(this.selectedDate);
                const notes = DataManager.getItems(CONFIG.STORAGE_KEYS.NOTES, dateKey);
                const expenses = DataManager.getItems(CONFIG.STORAGE_KEYS.EXPENSES, dateKey);

                this.renderNotes(notes, dateKey);
                this.renderExpenses(expenses, dateKey);
                this.updateStats();
            }

            renderNotes(notes, dateKey) {
                const notesList = document.getElementById('notesList');
                if (!notesList) return;

                if (notes.length === 0) {
                    notesList.innerHTML = this.getEmptyStateHTML('æš‚æ— è®°äº‹');
                    return;
                }

                const fragment = document.createDocumentFragment();
                notes.forEach(note => {
                    const item = this.createNoteElement(note, dateKey);
                    fragment.appendChild(item);
                });

                notesList.innerHTML = '';
                notesList.appendChild(fragment);
            }

            createNoteElement(note, dateKey) {
                const div = document.createElement('div');
                div.className = 'item';
                div.setAttribute('role', 'listitem');
                
                div.innerHTML = `
                    <div class="item-header">
                        <span class="item-date">${new Date(note.timestamp).toLocaleString('zh-CN')}</span>
                        <button class="item-delete" onclick="app.deleteNote('${dateKey}', '${note.id}')" 
                                aria-label="åˆ é™¤è®°äº‹" title="åˆ é™¤è®°äº‹">Ã—</button>
                    </div>
                    <div class="item-content">${Utils.escapeHtml(note.text)}</div>
                `;

                return div;
            }

            renderExpenses(expenses, dateKey) {
                const expensesList = document.getElementById('expensesList');
                if (!expensesList) return;

                if (expenses.length === 0) {
                    expensesList.innerHTML = this.getEmptyStateHTML('æš‚æ— æ¶ˆè´¹è®°å½•');
                    return;
                }

                const fragment = document.createDocumentFragment();
                expenses.forEach(expense => {
                    const item = this.createExpenseElement(expense, dateKey);
                    fragment.appendChild(item);
                });

                expensesList.innerHTML = '';
                expensesList.appendChild(fragment);
            }

            createExpenseElement(expense, dateKey) {
                const div = document.createElement('div');
                div.className = 'item';
                div.setAttribute('role', 'listitem');
                
                div.innerHTML = `
                    <div class="item-header">
                        <span class="item-date">${new Date(expense.timestamp).toLocaleString('zh-CN')}</span>
                        <button class="item-delete" onclick="app.deleteExpense('${dateKey}', '${expense.id}')" 
                                aria-label="åˆ é™¤æ¶ˆè´¹è®°å½•" title="åˆ é™¤æ¶ˆè´¹è®°å½•">Ã—</button>
                    </div>
                    <div class="expense-item">
                        <div class="item-content">${Utils.escapeHtml(expense.description)}</div>
                        <div class="expense-amount">${Utils.formatCurrency(expense.amount)}</div>
                    </div>
                `;

                return div;
            }

            getEmptyStateHTML(message) {
                return `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div class="empty-state-text">${message}</div>
                    </div>
                `;
            }

            updateStats() {
                try {
                    const stats = DataManager.getStats(this.selectedDate);
                    
                    const todayElement = document.getElementById('todayExpense');
                    const monthElement = document.getElementById('monthExpense');
                    const avgElement = document.getElementById('avgExpense');

                    if (todayElement) todayElement.textContent = Utils.formatCurrency(stats.todayExpense);
                    if (monthElement) monthElement.textContent = Utils.formatCurrency(stats.monthExpense);
                    if (avgElement) avgElement.textContent = Utils.formatCurrency(stats.avgExpense);
                } catch (error) {
                    console.error('Error updating stats:', error);
                }
            }

            saveNote() {
                const input = document.getElementById('noteInput');
                if (!input) return;

                const text = input.value.trim();
                if (!text) {
                    this.showWarning('è¯·è¾“å…¥è®°äº‹å†…å®¹');
                    return;
                }

                try {
                    const dateKey = Utils.formatDate(this.selectedDate);
                    DataManager.addItem(CONFIG.STORAGE_KEYS.NOTES, dateKey, {
                        id: Utils.generateId(),
                        text: text,
                        timestamp: Utils.getCurrentTimestamp()
                    });

                    input.value = '';
                    this.renderCalendar();
                    this.renderData();
                    this.showSuccess('è®°äº‹å·²ä¿å­˜');
                } catch (error) {
                    console.error('Error saving note:', error);
                    this.showError('ä¿å­˜è®°äº‹å¤±è´¥');
                }
            }

            saveExpense() {
                const amountInput = document.getElementById('expenseAmount');
                const descInput = document.getElementById('expenseDesc');
                
                if (!amountInput || !descInput) return;

                const amount = amountInput.value.trim();
                const description = descInput.value.trim();

                if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                    this.showWarning('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
                    amountInput.focus();
                    return;
                }

                try {
                    const dateKey = Utils.formatDate(this.selectedDate);
                    DataManager.addItem(CONFIG.STORAGE_KEYS.EXPENSES, dateKey, {
                        id: Utils.generateId(),
                        amount: parseFloat(amount),
                        description: description || 'æœªå‘½åæ¶ˆè´¹',
                        timestamp: Utils.getCurrentTimestamp()
                    });

                    amountInput.value = '';
                    descInput.value = '';
                    this.renderCalendar();
                    this.renderData();
                    this.showSuccess('æ¶ˆè´¹è®°å½•å·²ä¿å­˜');
                } catch (error) {
                    console.error('Error saving expense:', error);
                    this.showError('ä¿å­˜æ¶ˆè´¹è®°å½•å¤±è´¥');
                }
            }

            deleteNote(dateKey, id) {
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°äº‹å—ï¼Ÿ')) return;

                try {
                    DataManager.deleteItem(CONFIG.STORAGE_KEYS.NOTES, dateKey, id);
                    this.renderCalendar();
                    this.renderData();
                    this.showSuccess('è®°äº‹å·²åˆ é™¤');
                } catch (error) {
                    console.error('Error deleting note:', error);
                    this.showError('åˆ é™¤è®°äº‹å¤±è´¥');
                }
            }

            deleteExpense(dateKey, id) {
                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆè´¹è®°å½•å—ï¼Ÿ')) return;

                try {
                    DataManager.deleteItem(CONFIG.STORAGE_KEYS.EXPENSES, dateKey, id);
                    this.renderCalendar();
                    this.renderData();
                    this.showSuccess('æ¶ˆè´¹è®°å½•å·²åˆ é™¤');
                } catch (error) {
                    console.error('Error deleting expense:', error);
                    this.showError('åˆ é™¤æ¶ˆè´¹è®°å½•å¤±è´¥');
                }
            }

            scheduleCleanup() {
                setInterval(() => {
                    try {
                        DataManager.cleanupOldData();
                    } catch (error) {
                        console.warn('Scheduled cleanup failed:', error);
                    }
                }, 24 * 60 * 60 * 1000);
            }

            showSuccess(message) {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Chronos', { body: message, icon: 'â±ï¸' });
                } else {
                    console.log(`âœ… ${message}`);
                }
            }

            showWarning(message) {
                alert(`âš ï¸ ${message}`);
            }

            showError(message) {
                alert(`âŒ ${message}`);
            }

            destroy() {
                this.stopClock();
                this.isInitialized = false;
                console.log('Chronos destroyed');
            }
        }

        // ==================== åº”ç”¨å¯åŠ¨ ====================
        let app;

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                try {
                    app = new ClockApp();
                    window.app = app;
                    
                    if ('Notification' in window && Notification.permission === 'default') {
                        Notification.requestPermission();
                    }
                } catch (error) {
                    console.error('Failed to start application:', error);
                    document.body.innerHTML = `
                        <div style="padding: 40px; text-align: center; font-family: sans-serif;">
                            <h1>âŒ åº”ç”¨åŠ è½½å¤±è´¥</h1>
                            <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                            <p style="color: #666; font-size: 14px;">${error.message}</p>
                        </div>
                    `;
                }
            });
        } else {
            try {
                app = new ClockApp();
                window.app = app;
            } catch (error) {
                console.error('Failed to start application:', error);
            }
        }

        export { app };
    </script>
</body>
</html>
